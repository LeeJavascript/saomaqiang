<!DOCTYPE html>
<html>
 <head> 
  <meta charset="utf-8" /> 
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="pragma" content="no-cache">
  <meta name="renderer" content="ie-comp">
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" /> 
  
  <title></title> 
  
  <style type="text/css">
  	.mui-input-row label
  	{
 		 font-family: "微软雅黑"; 
 	}
  </style>

  <link rel="stylesheet" type="text/css" href="css/mui/mui.min.css" /> 
 </head>  
 <body> 
  <header class="mui-bar mui-bar-nav"> 
  	<button style="line-height: 48px;" type="button" class="mui-left mui-action-back mui-btn mui-btn-link mui-btn-nav mui-pull-left">
		<span class="mui-icon mui-icon-left-nav"></span>返回
	</button>	
   	<h1 class="mui-title">注册</h1> 
    <button style="line-height: 48px;" id="get_code" type="button" class="mui-right mui-action-back mui-btn mui-btn-link mui-btn-nav mui-pull-right">
		获取验证码
	</button>	
  </header> 
  <div class="mui-content" style="margin-top:20px;"> 
   <form class="mui-input-group"> 
    <div class="mui-input-row"> 
     <label>账号</label> 
     <input id="username" type="text" value="" placeholder="请输入账号" class="mui-input-clear" /> 
    </div> 
    <div class="mui-input-row"> 
     <label>密码</label> 
     <input id="password" type="password" value="" placeholder="请输入密码" class="mui-input-clear" /> 
    </div> 
     <div class="mui-input-row"> 
     <label>手机号码</label> 
     <input id="phone" type="text" value="" placeholder="请输入手机号码" class="mui-input-clear" /> 
    </div> 
     <div class="mui-input-row"> 
     <label>验证码</label> 
     <input id="code" type="text" value="" placeholder="请输入验证码" class="mui-input-clear" /> 
    </div> 
   </form> 

  </div> 
  <div class="mui-content-padded" align="center" style="margin-top:20px;"> 
  
  <button id="region" class="mui-btn mui-btn-block mui-btn-primary">注册</button> 
  	
  </div> 
 
 <script src="js/mui/mui.min.lee.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/mui/mui.min.js" type="text/javascript" charset="utf-8"></script>
 <script src="js/My_Js/API.js" type="text/javascript" charset="utf-8"></script>
 </body>
 
 
 <script type="text/javascript">
 
 	
	
	
  
  
  //╠═╬═╬═╬═╬═╬═╬═╬═╬═╬═╣  公共变量   ╠═╬═╬═╬═╬═╬═╬═╬═╬═╬═╣
  	var obj_region = document.getElementById("region");
  	var obj_username = document.getElementById("username");
  	var obj_password = document.getElementById("password");
	var obj_phone = document.getElementById("phone");
	var obj_code = document.getElementById("code");
	var obj_get_code = document.getElementById("get_code");
	var guid = ""; //验证码专用guid
	var lock = false; //防止重复注册 
	 
	
	//获取验证码
	get_code.addEventListener("tap",function()
	{
		//获取手机号码
		var phone = obj_phone.value;
		
		//判断是否为空
		if(phone.length == 0)
		{
			mui.toast("请先输入手机号码"); 
			return;
		} 
		
		//验证手机号码合法性
		if(!/^(13[0-9]|14[0-9]|15[0-9]|18[0-9])\d{8}$/i.test(phone))
		{
		  mui.toast('请输入合法的手机号码');
		  return;
		}
		
		//生成验证码专用guid,存储全局变量中
		guid = newGuid();
		
		//为了安全起见，将验证码放入缓存
		localStorage.setItem("guid",guid); 
		
		//如果合法则调用接口
		InvokeApi(GetApiUrl("Global_V0001_5un29"), "G001_CustomerRegister", "GetVerCode", {"验证码请求号":guid,"手机号码":phone}, "CYAPI_获取验证码");		
	})
	
	
	//注册
	region.addEventListener('tap',function()
	{
		//锁，防止重复提交
		lock == true?return false; 
		
		//改变提示
 		obj_region.innerHTML = "验证中...";
 		
 		//加上锁
 		lock = true;
 		
 		//所有值
 		var username = obj_username.value;
 		var password = obj_password.value;
		var phone = obj_password.value;
 		var code = obj_get_code.value;
	
	
		if(username.length == 0)
		{
			mui.toast("您的账号不可为空！"); 
			return;
		}
		else
		{
			//验证账号
			 InvokeApi(GetApiUrl("Global_V0001_5un29"), "G001_CustomerRegister", "CheckLoginName", {"登录名":username}, "CYAPI_检验登陆名")
		}
		
		if (password.length == 0) 
		{
			mui.toast("您的密码不可为空!");
			return;
		}
		else
		{
			//验证账号(本地),必须有大小写组合
			
		}
		
		if(phone.length == 0)
		{
			mui.toast("您的手机号码不可为空！"); 
			return;
		} 
		else
		{
			//验证手机号码合法性
			if(!/^(13[0-9]|14[0-9]|15[0-9]|18[0-9])\d{8}$/i.test(phone))
			{
			  mui.toast('请输入合法的手机号码');			 
			  return;
			}
		}
		
		if (code.length == 0) 
		{
			mui.toast("请点击右上角获取验证码,当然你先得输入手机号码!");
			return;
		} 
		else
		{
			//检验验证码
		 	InvokeApi(GetApiUrl("Global_V0001_5un29"), "G001_CustomerRegister", "CheckVerCode", {"登录账号":username,"密码":password}, "CYAPI_获取返回值");
		}
		 
	    InvokeApi(GetApiUrl("Global_V0001_5un29"), "G001_Customer", "Login", {"登录账号":username,"密码":password}, "CYAPI_获取返回值")
		 
	})    
	
	//╠═╬═╬═╬═╬═╬═╬═╬═╬═╬═╣  生成Guid ╠═╬═╬═╬═╬═╬═╬═╬═╬═╬═╣
	function newGuid()
	{
	    var guid = "";
	    for (var i = 1; i <= 32; i++){
	      var n = Math.floor(Math.random()*16.0).toString(16);
	      guid +=   n;
	      if((i==8)||(i==12)||(i==16)||(i==20))
	        guid += "-";
	    }
	    return guid.replace(/-/g,"");     
	}
	
	CYAPI_注册用户 = function(str)
	{
				
		alert(str);
		
		var jsonobj = Api_filter(str);
	
	}
	
	
	CYAPI_检验登陆名 = function(str)
	{
		
		alert(str);
		
		var jsonobj = Api_filter(str);
	
	}
	
	
	CYAPI_获取验证码 = function(str)
	{
		
		alert(str);
		
		var jsonobj = Api_filter(str);
	
	}
	
	
	CYAPI_检验验证码 = function(str)
	{
		
		alert(str);
		
		var jsonobj = Api_filter(str);
	
	}
	

 </script>
 
</html>