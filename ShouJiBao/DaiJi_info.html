<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="expires" content="0">
		<meta http-equiv="cache-control" content="no-cache">
		<meta http-equiv="pragma" content="no-cache">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<title>订单列表</title>

		<link rel="stylesheet" type="text/css" href="../css/mui/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="../css/mui/mui.picker.min.css" />
		<link rel="stylesheet" type="text/css" href="../css/My_css/ico.css" />
		<link rel="stylesheet" type="text/css" href="../css/My_css/global.css" />
		<link rel="stylesheet" type="text/css" href="../css/My_css/cover.css" />
		
		<style>
			.iconfont{font-size:30px}
			.mui-table .Lee_time{vertical-align:middle}
			.mui-table .Lee_time .iconfont{color:#007aff;font-size:26px}
			.mui-table .Lee_Order{margin:8px 0;color:#333}
			.mui-table .Lee_Phone{color:#333}
			.mui-table .Lee_Money{font-weight:700}
			.mui-bar .mui-segmented-control{top:6px;right:10px}
			.mui-segmented-control .mui-control-item{line-height:30px}
			.mui-pull-bottom-pocket{margin-bottom:40px}
			.mui-page,.mui-page-content,.mui-pages,.mui-view,.mui-views{position:absolute;top:0;right:0;bottom:0;left:0;width:100%;height:100%;background-color:#efeff4}
			.mui-pages{top:46px;height:auto}
			.mui-page.mui-transitioning{-webkit-transition:-webkit-transform .3s ease;transition:transform .3s ease}
			.mui-page-left{-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0)}
			.mui-ios .mui-page-left{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0)}
			.mui-page{display:none}
			.mui-pages .mui-page{display:block}
			.mui-off-canvas-wrap .mui-bar{box-shadow:#ccc 0 1px 6px 0}
			.mui-off-canvas-wrap{z-index:0}
			.mui-input-group .mui-input-row{height:43px}
		</style>

	</head>

	<body>



		<!--页面主结构 开始-->
		<div id="app" class="mui-views">
			<div class="mui-view">
				<div class="mui-navbar"></div>
				<div class="mui-pages"></div>
			</div>
		</div>
		<!--页面主结构 结束-->
		
		
		

		<!--主容器   -->
		<div id="Main" class="mui-page">

			<!--页面标题栏开始-->
			<div class="mui-navbar-inner mui-bar mui-bar-nav header">
				<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
				<h1 class="mui-title" id="mui-title">快递列表</h1>
				<a href="#add" class="mui-icon mui-pull-right mui-icon-plusempty" id="add_kuaidiyuan"><span style="font-size:16px;">添加</span></a>
			</div>
			<!--页面标题栏结束-->

			<div id="pullrefresh" class="mui-page-content mui-content mui-inner-wrap mui-scroll-wrapper">
				<div class="mui-scroll">
					<ul style="margin-top: 0px;" id="mui-table-view" class="mui-table-view mui-table-view-striped mui-table-view-condensed">
						<!-- 
						<li class="mui-table-view-cell">
							<div class="mui-slider-right" style="z-index: 9999;"> 
								<a id="slider-delete"  class="mui-btn mui-btn-red">删除</a>		
							</div>							
							<a class="goto_subpage" >
								<div class="mui-slider-handle">
									<div class="mui-table">
										<div class="mui-table-cell mui-col-xs-9">
											<h4 class="Lee_Money">联系人：李四</h4>
											<h5 class="Lee_Order"><i class="mui-icon mui-icon-compose"></i>&nbsp;客服电话 ：6264184415221 </h5>
											<p class="mui-h5 mui-ellipsis Lee_Phone"><i class="mui-icon mui-icon-phone"></i>&nbsp;联系电话：137-13332652</p>
										</div>
										<div class="mui-table-cell mui-col-xs-3 mui-text-right Lee_time">
											<p><img src="../Images/kuaidigongsi/500.jpg" width="60" /></p>
											<span class="mui-h5" style="color:#000">顺丰快递</span>
										</div>
									</div>
								</div>
							</a>
						</li>
						-->
					</ul>
				</div>
			</div>
		</div>



		<!-- 添加 -->
		<div id="add" class="mui-page">
			<div class="mui-navbar-inner mui-bar mui-bar-nav mui-action-back">
				<button type="button" class="mui-left mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
					<span class="mui-icon mui-icon-left-nav"></span>
				</button>
				<h1 class="mui-center mui-title">添加快递员</h1>
			</div>
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">						
						<form class="mui-input-group">
							<div class="mui-input-row">
								<label>联系人</label>
								<input id="add_lianxiren" readonly="readonly" onclick="parent.shurufa_open(this)" type="text" value="" placeholder="请输入联系人" class="mui-input-clear" />
							</div>
							<div class="mui-input-row">
								<label>联系电话</label>
								<input id="add_lianxidianhua" readonly="readonly" onclick="parent.shurufa_open(this)" type="text" value="" placeholder="请输入联系电话" class="mui-input-clear" />
							</div>							
						</form>						
						<a style="margin-top:10px" id="add_btn" class="mui-btn mui-btn-warning mui-btn-block">保 存</a>		
					</div>
				</div>
			</div>
		</div>


<div data-role="popup" id="Cy-Tp-XieYi" data-overlay-theme="a" data-theme="a" data-dismissible="false" style="display:none">

			<div role="main" class="ui-content">

				<div class="col-xs-12 well" id="Div1" style="max-height: 200px;overflow: auto;">
					<div>
						<div style="text-align:center"><span style="font-size:24px;line-height: 40px;" id="kuaidiinfo_title">《收费协议》</span></div>
						
						<div style="text-align:left" id="kuaidiinfo">
							
						</div>
					</div>
				</div>

				<p style="margin:10px 0px 0px 0px;text-align:center;">
					<a id="Cy_Tp_Agree" onclick="Cy_Tp_cannel()" style="z-index: 9999;margin-right: 10px;color:#fff" class="mui-btn mui-btn-outlined">确 认</a>
					<a id="Cy_Tp_cannel" onclick="Cy_Tp_cannel()" style="z-index: 9999;color:#fff" class="mui-btn mui-btn-outlined">取 消</a>
				</p>
			</div>
</div>




<span style="display: none;">
	<input type="hidden" name="page" id="page" value="1" />  	
</span>


		

<script type="text/template" id="temple">
{{# for(var i =0,len = d.length; i	< len;i++){ }} 
	<li class="mui-table-view-cell">
		<div class="mui-slider-right" style="z-index: 9999;"> 
			<a data-id="{{d[i].id}}" class="mui-btn mui-btn-red slider-delete" >删除</a>		
		</div>							
		<a class="goto_subpage"> 
			<div class="mui-slider-handle">
				<div class="mui-table">
					<div class="mui-table-cell mui-col-xs-9">
						<h4 class="Lee_Money">联系人：{{d[i].name}}</h4>
						<h5 class="Lee_Order"><i class="mui-icon mui-icon-compose"></i>&nbsp;客服电话 ：{{d[i].companyPhone}} </h5>
						<p class="mui-h5 mui-ellipsis Lee_Phone"><i class="mui-icon mui-icon-phone"></i>&nbsp;联系电话：{{d[i].mobile}}</p>
					</div>
					<div class="mui-table-cell mui-col-xs-3 mui-text-right Lee_time">
						<p><img src="../Images/kuaidigongsi/500.jpg" width="60" /></p>
						<span class="mui-h5" style="color:#000">{{d[i].companyName}}</span>
					</div>
				</div>
			</div>
		</a>
	</li> 
{{# } }}
</script>

		<script src="../js/jquery/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<!--<script src="../js/Zepto/zepto_1.1.3.js" type="text/javascript" charset="utf-8"></script>-->
		<script src="../js/mui/mui.min.lee.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/mui/mui.view.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/layermobile/layer.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/layer/laytpl.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/My_Js/global.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/My_Js/API.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/My_Js/MyValidate.js" type="text/javascript" charset="utf-8"></script>


		<script type="text/javascript" charset="UTF-8">
		
			//∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏ 初始化公共数据  开始 ∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏
			
			var username = localStorage.登录帐号;	//登录帐号
			
			var 冲正申请人 = localStorage.EmployeeCode; //员工号
			 
			var CustomerCode = localStorage.CustomerCode; //门店号
			
			var rows = "10";		//每次加载的行数、可修改、但数据太多容易导致缓慢卡屏等	
		
			var cnt = 0; 	//数据总条数
		
			var ResultJson = {};	//获取的列表数据
			
			var state = "";  //默认业务状态，""为所有	
			
			var Is_Frist = true; //这个锁是为了限制上拉加载的自动触发。计划是初始化10条会变成20条过份冗长
						
			var companyID =  get_urlpara(); //获取id参数
			
			//∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏ 初始化公共数据  结束 ∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏
			
			
			$(function() 
			{							
				初始化数据(); //初始化数据   
				
				var companyName = change_companyName(companyID);	
				
				$("#kuaidiinfo_title,#mui-title").text(companyName);				
				 
			})
			
			
			
			//添加快递员事件
			document.getElementById("add_btn").addEventListener("tap",function()
			{								
				var kuaiDiYuanName = $("#add_lianxiren").val();
				var kuaiDiYuanMobile = $("#add_lianxidianhua").val();
				
				if(!Is_Null(kuaiDiYuanName,"请输入联系人姓名")) return false;
				if(!Is_Null(kuaiDiYuanMobile,"请输入联系人电话")) return false;
				if(!Is_Phone(kuaiDiYuanMobile,"请输入正确合法的手机号码")) return false;
				 
				var method = "add";
				//console.log(JSON.stringify({"userCode":CustomerCode,"companyID":companyID,"kuaiDiYuanName":kuaiDiYuanName,"kuaiDiYuanMobile":kuaiDiYuanMobile,"method":method}));
				InvokeApi(GetApiUrl("B003_V0001_5un29"), "ApiClass", "SetKuaiDiYuan", {"userCode":CustomerCode,"companyID":companyID,"kuaiDiYuanName":kuaiDiYuanName,"kuaiDiYuanMobile":kuaiDiYuanMobile,"method":method} , "CYAPI_添加快递员");
			})
			
			
			
			/* 这是简单的关闭layer */
			Cy_Tp_cannel = function() 
			{
				layer.closeAll();
			}
			
			
			
			/* 快递公司收费明细 */
			show_代寄明细 = function()
			{
				layer.open({type:2,time:1.5});	//蒙版
										
				InvokeApi(GetApiUrl("B003_V0001_5un29"), "ApiClass", "ChaCompanyFee", {"userCode":CustomerCode,"companyID":companyID} , "CYAPI_代寄明细");
			}
						
						
			/* 删除 */
			delete_快递员 = function(elem) 
			{						
				var li = $(elem).parent().parent()[0];
								
				var btnArray = ['否', '是'];
				mui.confirm('你确定要删除该快递员吗？', '温馨提示', btnArray, function(e) 
				{
					if (e.index == 1)
					{						
						var id = $(this).attr("data-id");  //获取id
						var kuaiDiYuanName = "";
						var kuaiDiYuanMobile = "";
						var method = "delete";
						
						//alert(JSON.stringify({"userCode":CustomerCode,"companyID":companyID,"kuaiDiYuanName":kuaiDiYuanName,"kuaiDiYuanMobile":kuaiDiYuanMobile,"id":id,"method":method}));
						InvokeApi(GetApiUrl("B003_V0001_5un29"), "ApiClass", "SetKuaiDiYuan", {"userCode":CustomerCode,"companyID":companyID,"kuaiDiYuanName":kuaiDiYuanName,"kuaiDiYuanMobile":kuaiDiYuanMobile,"id":id,"method":method} , "CYAPI_删除快递员");
						
					} 
					else
					{		
						mui.swipeoutClose(li);
						return false;
					}
				})
			}
			
			
			
			初始化数据 = function() 
			{
				/*初始化*/
		     	layer.open({type:2,time:1.5});	//蒙版	
		     	mui("#pullrefresh").pullRefresh().refresh(true);		     	
		     	mui("#pullrefresh").pullRefresh().scrollTo(0,0,100); //滚动置顶		     	
		     	$("#mui-table-view").html(""); //清空所有的数据
		     	var page = 1;	//分页还原 
				$("#page").val(page); //分页标识变为1						
		     	ResultJson = null; //清空返回数据		
		     	
		     	
			    InvokeApi(GetApiUrl("B003_V0001_5un29"), "ApiClass", "ChaKuaiDiYuan", {"userCode":CustomerCode,"companyID":companyID} , "CYAPI_获取快递员列表");
			}
			
			
			
			
			 //∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏ 上拉刷新、下拉加载 开始  ∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏
		    
		    //下拉刷新具体业务实现
			function pulldownRefresh() 
			{
				setTimeout(function() 
				{								
					mui.toast("刷新成功");  //暂未实现下拉刷新，甚至可能关闭此功能
					
					mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
				
				}, 1500);
			}        
		     		 	 
		    //上拉加载具体业务实现
			function pullupRefresh() 
			{
				
				//加载数据
				setTimeout(function() 
				{		
					var num =  $("#pullrefresh .mui-table-view-cell").size(); //列表总数
												
					if(num >= cnt)
					{		
						mui('#pullrefresh').pullRefresh().endPullupToRefresh(num >= cnt); //参数为true代表没有更多数据了。
						return false;
					}		
				
					if(Is_Frist)
					{
						Is_Frist = false; //解除限制，之后的都可以通过了
						//首次加载数据的时候，不必再运行加载。
						//计划是初始化10条，如果再次执行这个会变成20条过份冗长，
						//但这个位置不能改变，因为要通过上面的判断来查看是否显示“没有更多数据了”。
						//并且只能通过这个函数来使用才可以的
						return false;  
					}		 
				
					
					/* 获取和设置基本参数 */
					var page = parseInt($("#page").val()) + 1; //获取当前分页标识+1
					$("#page").val(page); //设置分页标识	
				
					 
				   InvokeApi(GetApiUrl("B003_V0001_5un29"), "ApiClass", "ChaKuaiDiYuan", {"userCode":CustomerCode,"companyID":companyID} , "CYAPI_获取快递员列表");
					 
				}, 1500);
			}       
			
			//∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏ 上拉刷新、下拉加载  结束  ∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏
			
			
			
			
			//专门用来初始化的函数 
			CYAPI_获取快递员列表 = function(str) 
			{				
				layer.closeAll();
				
				var jsonobj = Api_filter(str);
				
				ResultJson = jsonobj["kuiDiYuanList"] || {};				
				 
				//替换美化文本
				$.each(ResultJson, function(i, o) 
				{
					o.companyName = change_companyName(o.companyName);					
				})
				
				var temple_html = $("#temple").html();
								
				laytpl(temple_html).render(ResultJson, function(html) 
				{
					$("#mui-table-view").append(html); //填充初始化数据     
					
					$(".goto_subpage").bind("tap",function(){
						show_代寄明细();
					});
					
					$(".slider-delete").bind("tap",function()
					{
						delete_快递员($(this));
					});
					 
				});
				
				var count = cnt; //数据库总数
				
				var num = $(".mui-table-view-cell").size(); //列表总数
				
				mui('#pullrefresh').pullRefresh().endPullupToRefresh(num >= count); //参数为true代表没有更多数据了。
			}
			
			//CYAPI_删除快递员
			CYAPI_删除快递员 = function(str)
			{
				//alert(str);
				var myjson = Api_filter(str); 
				var retCode = myjson.retCode;
				var retMessage = myjson.retMessage; 
				
				if(retCode == "1")
				{
					//删除成功
					mui.alert('删除成功', '温馨提示', function() 
					{
						//mui.swipeoutClose(li); 
						window.location.reload();
					});
				}
				
				
				
			}
			
			
			//CYAPI_代寄明细
			CYAPI_代寄明细 = function(str)
			{ 
				alert(str);
				layer.closeAll();
				str = str.replace(/\n|\r/g, "");
				var myjson = Api_filter(str);  
				
				var feeBody = myjson.feeBody;  
				var retCode = myjson.retCode;
				var retMessage = myjson.retMessage; 
				
				$("#kuaidiinfo").html(feeBody);
				
				
				if(retCode != "1")
				{
					mui.alert(retMessage);
					return false;
				}
				else
				{
					layer.open
					({
						style: "width:80%;color:#fff;background:rgba(0,0, 0, .6);border-radius:20px;",
						closeBtn: 0,
						title: false,
						shadeClose: true,
						content: $("#Cy-Tp-XieYi").html(),
						btn: 0 //默认底部不显示任何按钮					
					});
				}				
			}
			
			
			//CYAPI_添加快递员
			CYAPI_添加快递员 = function(str) 
			{
				//alert(str);
				var json = Api_filter(str);
				var retMessage = json.retMessage; 
				mui.alert(retMessage,function()
				{
					if(json.retCode == "1")
					{
						window.location.reload();
					}					
				});				
			}
			
			
			//根据公司代码替换公司名称
			change_companyName = function(str)
			{
				if(str == "500")
				{
					str = "顺丰快递";
				}
				else if(str == "101")
				{
					str = "中通快递";
				}
				else if(str == "102")
				{
					str = "圆通快递";
				}
				return str;
			}
			
			
			//初始化单页view
			var viewApi = mui('#app').view({
				defaultPage: '#Main'
			});
			mui.init({
				pullRefresh: {
					container: '#pullrefresh',
					down: {
						callback: pulldownRefresh
					},
					up: {
						contentrefresh: '正在加载...',
						callback: pullupRefresh
					}
				}
			});
			if (mui.os.plus) {
				mui.plusReady(function() {
					setTimeout(function() {
						mui('#pullrefresh').pullRefresh().pullupLoading();
					}, 1000);
				});
			} else {
				mui.ready(function() {
					mui('#pullrefresh').pullRefresh().pullupLoading();
				});
			}
			var view = viewApi.view;
			(function($) {
				//处理view的后退与webview后退
				var oldBack = $.back;
				$.back = function() {
					if (viewApi.canBack()) { //如果view可以后退，则执行view的后退
						viewApi.back();
					} else { //执行webview后退
						oldBack();
					}
				};
				//监听页面切换事件方案1,通过view元素监听所有页面切换事件，目前提供pageBeforeShow|pageShow|pageBeforeBack|pageBack四种事件(before事件为动画开始前触发)
				//第一个参数为事件名称，第二个参数为事件回调，其中e.detail.page为当前页面的html对象
				view.addEventListener('pageBeforeShow', function(e) {
					//				console.log(e.detail.page.id + ' beforeShow');
				});
				view.addEventListener('pageShow', function(e) {
					//				console.log(e.detail.page.id + ' show');
				});
				view.addEventListener('pageBeforeBack', function(e) {
					//				console.log(e.detail.page.id + ' beforeBack');
				});
				view.addEventListener('pageBack', function(e) {
					//				console.log(e.detail.page.id + ' back');
				});
			})(mui);
		</script>
	</body>

</html>