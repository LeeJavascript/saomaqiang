<!DOCTYPE html>
<html>

	<head>   
		<meta charset="utf-8">
		<title>Hello MUI</title>				
		<meta http-equiv="expires" content="0">
		<meta http-equiv="cache-control" content="no-cache">
		<meta http-equiv="pragma" content="no-cache">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
			
		<title></title>
		<link rel="stylesheet" type="text/css" href="../css/mui/mui.min.css"/>
		<link rel="stylesheet" type="text/css" href="../css/My_css/ico.css"/>
		<link rel="stylesheet" type="text/css" href="../css/My_css/global.css"/>
		<style>
			/* 无缝DIV */
			.mui-views,.mui-view, .mui-pages,.mui-page,.mui-page-content {position: absolute;left: 0;right: 0;top: 0;bottom: 0;width: 100%;height: 100%;background-color: #efeff4;}
			.mui-pages {top: 10px;height: auto;}
			.mui-page.mui-transitioning {-webkit-transition: -webkit-transform 300ms ease;transition: transform 300ms ease;}
			.mui-page-left {-webkit-transform: translate3d(0, 0, 0);transform: translate3d(0, 0, 0);}
			.mui-ios .mui-page-left {-webkit-transform: translate3d(-20%, 0, 0);transform: translate3d(-20%, 0, 0);}		
			.mui-page {display: none;}
			.mui-pages .mui-page {display: block;}	
			/* my */
			.mybtn{width:50%;height:80px;text-align:center;margin:25px auto;font-family:"微软雅黑";border-radius:10px;font-size:24px}
			.xingweiname{position:relative;top:-5px}
		</style>
	</head>

	<body>
		 
		 
		 
		 
		
		<!--页面主结构开始-->
		<div id="app" class="mui-views">
			<div class="mui-view">			
				<div class="mui-pages">
				</div>
			</div>
		</div>
		<!--页面主结构结束-->
		
		 
		
		<!--主页开始-->
		<div id="Main" class="mui-page">			
			<div class="mui-content"> 
					<a href="#set"><button type="button" style="margin-top: 5px;" class="mybtn mui-btn mui-btn-block"  id="Save" ><i class="iconfont">&#xe611;</i>&nbsp;&nbsp;<span class="xingweiname">存放物品</span></button></a>
					<a href="#get"><button type="button" class="mybtn mui-btn mui-btn-block"  id="Get"><i class="iconfont">&#xe610;</i>&nbsp;&nbsp;<span class="xingweiname">取回物品</span></button></a>
					<a href="Save_info.html"><button type="button" class="mybtn mui-btn mui-btn-block" id="Look" ><i class="iconfont">&#xe612;</i>&nbsp;&nbsp;<span class="xingweiname">记录查询</span></button></a>
			</div> 
		</div> 
		<!--主页结束--> 
		 
		
		
		
		 
		 <!--单页开始 -->
		<div id="set" class="mui-page">
			<div class="mui-content">				 
					<div class="mui-input-group">
						<div class="mui-input-row">
							<label>手机号码</label>
							<input id='set_phone' value="" onclick="parent.shurufa_open(this)" readonly="readonly" type="text" class="mui-input-clear mui-input" placeholder="请输入手机号码">
						</div>
					</div> 
					
					<div class="mui-content-padded">
						<button id='set_btn' class="mui-btn mui-btn-block mui-btn-primary">生成单号</button>
					</div>
					
					<div class="mui-content-padded">
						<p>务必输入真实可用的手机号码，下单成功后，用户需根据该号码核对取回物品</p>
					</div> 	
					
					<div id="set_code" style="display:none;padding:15px;border-radius: 5px; margin: 0px auto;text-align: center;">
						<p  style="color: red;font-size:30px;margin:20px;">存放号 : <span id="set_save_id" style="color: red;font-weight: bold;">未知</span></p>
						<p><img id="set_barcode"/></p>
						<p style="color: red;">注：前两个小时免费，超过后每小时收取1元，10元封顶。</p>
						<h5 class="mui-left">存放时间：<span id="set_save_time">未知</span></h5>						
						<h5 class="mui-left">存放商户电话：<span id="set_save_phone">未知</span></h5>
					</div>				
			</div>		 
		</div>
		<!--单页结束--> 
		
		
		  
		  
		 <!--单页开始 这里的Get是关键字，所以需要变成小写 -->
		<div id="get" class="mui-page">
			<div class="mui-content">
					<div class="mui-input-group">
						<div class="mui-input-row">
							<label>取货码</label>
							<input id='quKey' onclick="parent.shurufa_open(this)" readonly="readonly" type="text" class="mui-input-clear mui-input" placeholder="请输入条形码">
						</div>
					</div> 
					
					<div class="mui-content-padded">						
						<button id='get_btn' class="mui-btn mui-btn-block mui-btn-primary">确认</button>
					</div>
					
					<div class="mui-content-padded">
						<p>可选择输入条形码或者扫描条形码进行验证</p>
					</div> 	
					
					<div id="get_code" style="display:none;padding:15px;border-radius: 5px; margin: 0px auto;text-align: center;">
						<p style="color: red;font-size:30px;margin:20px;">存放号 : <span id="get_save_id" style="color: red;font-weight: bold;">未知</span></p>
						<p><img id="get_barcode"/></p>
						<p>注：前两个小时免费，超过后每小时收取1元，10元封顶。</p>
						<h5 class="mui-left">存放时间：<span id="get_save_time">未知</span></h5>
						<h5 class="mui-left">存放地址：<span id="get_save_address">未知</span></h5>
						<h5 class="mui-left">存放商户电话：<span id="get_save_phone">未知</span></h5>
					</div>					
			</div> 	
		</div>
		<!--单页结束--> 
		
		
		
	
		<script src="../js/jquery/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/mui/mui.min.lee.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/mui/mui.view.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/My_Js/global.js" type="text/javascript" charset="utf-8"></script>	
		<script src="../js/JsBarcode/CODE39.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/JsBarcode/JsBarcode.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/layermobile/layer.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/My_Js/MyValidate.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/My_Js/API.js" type="text/javascript" charset="utf-8"></script>
	
	<script type="text/javascript">
			
			
			//∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏ 初始化公共数据  开始 ∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏
			
			var username = localStorage.登录帐号;	//登录帐号
			
			var Operator = localStorage.EmployeeCode; //员工号
			 
			var CustomerCode = localStorage.CustomerCode; //门店号
			
			
			$(function()
			{		
			}) 
			
			//存物品
			document.getElementById("set_btn").addEventListener("tap",function()
			{
				
				var set_phone = document.getElementById("set_phone").value;
				if(!Is_Null(set_phone,"请输入手机号码")) return false;
		 		if(!Is_Phone(set_phone,"请输入正确合法的手机号码")) return false;
		 		
		 		$("#set_btn").text("提交中，请稍后...");
		 		
		 		 opt =
				 {
				 	"userCode":CustomerCode,
				 	"mobile":set_phone,
				 	"employeeCode":Operator
				 }	
				 
				 
				 InvokeApi(GetApiUrl("B003_V0001_5un29"), "ApiClass", "CunPackage", opt, "CYAPI_存包裹");
			})
			
			//取物品
			document.getElementById("get_btn").addEventListener("tap",function()
			{
				var quKey = document.getElementById("quKey").value;
				
		 		if(!Is_Null(quKey,"请扫描或者输入订单号")) return false;
		 		
		 		$("#get_btn").text("提交中，请稍后...");
		 		
		 		 opt =
				 {
				 	"userCode":CustomerCode,
				 	"quKey":quKey
				 }	
				  
				 //console.log(JSON.stringify(opt));
				 
				 InvokeApi(GetApiUrl("B003_V0001_5un29"), "ApiClass", "QuHuiPackage", opt, "CYAPI_取包裹");

			})
			
			
			
	 		
			  
			 //--------------------
			 CYAPI_存包裹 = function(str)
			 {
			 	setTimeout(function()
			 	{
			 		
			 		$("#set_btn").text("确定");
			 		var json = Api_filter(str);		
		 			var cunNo = json.cunNo || "00";				//存放号
			 		var orderid = json.orderId || "00000000"; 	//订单号
			 		
			 		mui.toast(json.retMessage + "\r\n" + "请提示用户拍照保留");
		 				
	 				存放物品_生成条形码(cunNo,orderid);
	 				
	 				
			 		
			 	},1000);
			 	
			 }
			 
			 
			 
			 CYAPI_取包裹 = function(str)
			 {
			 	setTimeout(function()
			 	{			 		
	 				$("#get_btn").text("确定");
			 		var json = Api_filter(str);		
			 		
			 		var retMessage = json.retMessage;			//返回的信息
			 		var retCode = json.retCode;					//返回的操作码
			 		if(retCode == "0")
			 		{		
			 			mui.alert(retMessage);
			 			return false;
	 				}
			 		else if(retCode == "1")
			 		{
			 			mui.alert(retMessage);
	 					var cunNo = json.cunNo;						//存放号
				 		var orderId = json.orderId; 				//订单号
				 		var time = json.time; 						//寄存时长
		 				var fee = json.fee; 						//费用
		 				var phone = json.phone;						//手机号码	 				
				 				 				
		 				取回物品_生成条形码(orderId,phone,time,cunNo);		 			
			 		}
			 		
	 			},1000);
			 }
			 
			 
		   	存放物品_生成条形码 = function(cunNo,Orderid)
			{ 
				var now = new Date(); 	//当前时间
				now = now.format("yyyy-MM-dd hh:mm:ss");
				var phone = $("#set_phone").val();  //获取手机号码
				$("#set_barcode").JsBarcode(Orderid,{format:"CODE39", width:1, displayValue: true});
				$("#set_save_id").text(cunNo);
				$("#set_save_time").text(now);				
				$("#set_save_phone").text(phone);
				$("#set_code").fadeIn("slow");	
				
				$("html,body").animate({scrollTop:$("#app").height()}, '1000'); 
				
				
			}
			
			
			
		   	取回物品_生成条形码 = function(orderId,phone,time,cunNo)
			{ 
				$("#get_barcode").JsBarcode("orderId",{format:"CODE39", width:1, displayValue: true});
				$("#get_save_id").text(cunNo);
				$("#get_save_time").text(time);
				$("#get_save_phone").text(phone);
				$("#get_code").fadeIn("slow");	
				$("html,body").animate({scrollTop:$("#app").height()}, '1000'); 
			}
			 
			  
			 
			//∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏ 以下区域不必改动 ∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏
							 
			//初始化单页view
			var viewApi = mui('#app').view({
				defaultPage: '#Main'
			});
		
		
			var view = viewApi.view;
			(function($) {
				//处理view的后退与webview后退
				var oldBack = $.back;
				$.back = function() {
					if (viewApi.canBack()) { //如果view可以后退，则执行view的后退
						viewApi.back();
					} else { //执行webview后退
						oldBack();
					}
				};
				//监听页面切换事件方案1,通过view元素监听所有页面切换事件，目前提供pageBeforeShow|pageShow|pageBeforeBack|pageBack四种事件(before事件为动画开始前触发)
				//第一个参数为事件名称，第二个参数为事件回调，其中e.detail.page为当前页面的html对象
				view.addEventListener('pageBeforeShow', function(e) {
					//				console.log(e.detail.page.id + ' beforeShow');
				});
				view.addEventListener('pageShow', function(e) {
					//				console.log(e.detail.page.id + ' show');
				});
				view.addEventListener('pageBeforeBack', function(e) {
					//				console.log(e.detail.page.id + ' beforeBack');
				});
				view.addEventListener('pageBack', function(e) {
					//				console.log(e.detail.page.id + ' back');
					});
				})(mui);
		</script>
	</body>
</html>