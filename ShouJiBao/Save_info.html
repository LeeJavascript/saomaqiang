<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<title>订单列表</title>

		<link href="../css/mui/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/mui/mui.picker.min.css" />
		<link rel="stylesheet" type="text/css" href="../css/My_css/ico.css" />
		<link rel="stylesheet" type="text/css" href="../css/My_css/global.css" />
		<link rel="stylesheet" type="text/css" href="../css/My_css/cover.css"/>
		<style>
			.iconfont{font-size:30px}
			.mui-table .Lee_time{vertical-align:middle}
			.mui-table .Lee_time .iconfont{color:#007aff;font-size:26px}
			.Lee_phone,.mui-table .Lee_id{margin:8px 0;color:#333}
			.mui-table .Lee_Phone{color:#333}
			.mui-table .Lee_Money{font-weight:700}
			.mui-bar .mui-segmented-control{top:6px;right:10px}
			.mui-segmented-control .mui-control-item{line-height:30px}
			.mui-pull-bottom-pocket{margin-bottom:40px}
			.mui-page,.mui-page-content,.mui-pages,.mui-view,
			.mui-views{position:absolute;top:0;right:0;bottom:0;left:0;width:100%;height:100%;background-color:#efeff4}
			.mui-pages{top:55px;height:auto}
			.mui-page.mui-transitioning{-webkit-transition:-webkit-transform .3s ease;transition:transform .3s ease}
			.mui-page-left{-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0)}
			.mui-ios .mui-page-left{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0)}
			.mui-page{display:none}
			.mui-pages .mui-page{display:block}
			.mui-page .mui-table-view:first-child{margin-top:15px}
			.mui-page .mui-table-view:last-child{margin-bottom:30px}
			.mui-table-view{margin-top:20px}
			
			/* 加强 */
			.mui-bar{height: 55px;}
			.mui-bar .mui-btn-link{top:5px;}
			.mui-bar .mui-icon{padding-top:15px}
		</style>

	</head>

	<body>

		
		<div id="app" class="mui-views">
			<div class="mui-view">
				<div class="mui-navbar">
				</div>
				<div class="mui-pages">
					
				</div>
			</div>
		</div>
		<!--页面主结构结束-->

			<!--侧滑菜单容器   -->
			<div id="Main" class="mui-page mui-off-canvas-wrap mui-draggable">
				<!--页面标题栏开始--> 
				<div class="mui-navbar-inner mui-bar mui-bar-nav header">				
						<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
							<span class="mui-icon mui-icon-left-nav"></span>
						</button>
						<div id="tapstate" class=" mui-segmented-control" style="width: 70%;position: absolute;left: 2%;top: 13px;">
							<a href="#" class="mui-control-item mui-active">所有物品</a>
							<a href="#" class="mui-control-item">未收物品</a>
							<a href="#" class="mui-control-item">已收物品</a>
							<a href="#" class="mui-control-item">已退物品</a>
						</div>
						<a class="mui-icon mui-pull-right iconfont" id="select_time">&#xe606;</a>
				</div>
				<!--页面标题栏结束-->
	
	
				<div id="pullrefresh" class="mui-page-content mui-content mui-inner-wrap mui-scroll-wrapper">
					<div class="mui-scroll">
						<ul style="margin-top: 0px;" id="mui-table-view" class="mui-table-view mui-table-view-striped mui-table-view-condensed">
							<!--
							<li class="mui-table-view-cell">	
								<a class="goto_subpage">
									<div class="mui-slider-handle">
										<div class="mui-table">									
											<div class="mui-table-cell mui-col-xs-7">
												<h4 class="mui-ellipsis-2 Lee_Money">￥ 0.00</h4> 
												<h5 class="Lee_id"><i class="mui-icon mui-icon-compose"></i>&nbsp;存放号：01</h5>
												<h5 class="Lee_phone"><i class="mui-icon mui-icon-phone"></i>&nbsp;手机号码：13713332652</h5>
																							
											</div>
											<div class="mui-table-cell mui-col-xs-5 mui-text-right Lee_time">
												<span class="mui-h5">今天  16:30</span>
												<span class="mui-h5"><i class="iconfont">&nbsp;&#xe604;</i></span>
											</div>
										</div>
									</div>
								</a> 
							</li> 
							-->
						</ul>
					</div>
				</div>
			</div>

			<!--单页面结束-->	 
			<div id="info" class="mui-page mui-action-back" style="z-index: 10;">				
				<div class="mui-navbar-inner mui-bar mui-bar-nav">
					<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
						<span class="mui-icon mui-icon-left-nav"></span>
					</button>
					<h1 class="mui-center mui-title ">详情</h1>
				</div>
				<div class="mui-page-content" id="sub_page">
					<div class="mui-scroll-wrapper">
						<div class="mui-scroll">
							<div id="order" style="padding:15px;border-radius: 5px; margin: 0px auto;text-align: center;">
								<p>存放号 : <span class="save_id" style="color: red;font-weight: bold;">未知</span></p>
								<p><img id="barcode2"/></p>
								<p style="color: red;">注：前两个小时免费，超过后每小时收取1元，10元封顶。</p>
								<h5 class="mui-left">存放时间：<span class="save_time">未知</span></h5>
								<h5 class="mui-left">存放地址：<span class="save_address">未知</span></h5>
								<h5 class="mui-left">存放商户电话：<span class="save_phone">未知</span></h5>
							</div>
						</div>
					</div>
				</div>			
			</div>
		
		
		
		


<span style="display: none;">
	<input type="hidden" name="page" id="page" value="1" />  
	<button id='dipicker' data-options='{"type":"date","beginYear":2015,"endYear":2016}' class="btn hidden mui-btn mui-btn-block">选择日期 ...</button>
</span>


<script type="text/template" id="temple">
{{# for(var i =0,len = d.length; i< len;i++){ 	}} 
		
	<li class="mui-table-view-cell">	
			<a class="goto_subpage">
				<div class="mui-slider-handle">
					<div class="mui-table">									
						<div class="mui-table-cell mui-col-xs-7">
							<h4 class="mui-ellipsis-2 Lee_Money">￥ {{d[i].fee}}</h4> 
							<h5 class="Lee_id"><i class="mui-icon mui-icon-compose"></i>&nbsp;存放号：{{d[i].cunNo}}</h5>
							<h5 class="Lee_phone"><i class="mui-icon mui-icon-phone"></i>&nbsp;手机号码：{{d[i].mobile}}</h5>
																		
						</div>
						<div class="mui-table-cell mui-col-xs-5 mui-text-right Lee_time">
							<span class="mui-h5">{{d[i].cunDateTime}}</span>
							<span class="mui-h5"><i class="iconfont">{{d[i].status}}</i></span>
						</div>
					</div>
				</div>
			</a> 
	</li> 
{{#     }	 }}
</script> 
 
		 
		 
		 
<script src="../js/jquery/jquery.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/mui/mui.min.lee.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/layermobile/layer.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/mui/mui.view.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/layer/laytpl.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/mui/mui.picker.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/My_Js/global.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/My_Js/API.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/JsBarcode/CODE39.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/JsBarcode/JsBarcode.js" type="text/javascript" charset="utf-8"></script>



		<script type="text/javascript" charset="UTF-8">
		
		
			//∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏ 初始化公共数据  开始 ∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏
			
			var username = localStorage.登录帐号;	//登录帐号
			
			var 冲正申请人 = localStorage.EmployeeCode; //员工号
			 
			var CustomerCode = localStorage.CustomerCode; //门店号
			
			var rows = "10";		//每次加载的行数、可修改、但数据太多容易导致缓慢卡屏等	
		
			var cnt = 1; 	//数据总条数
		
			var ResultJson = {};	//获取的列表数据
			
			var state = "";  //默认业务状态，""为所有	
			
						
			//∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏ 初始化公共数据  结束 ∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏
			
			
			
			
			
			
		  	//∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏ 载入事件  开始 ∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏
		     $(function() 
		     {	     			 
		     							
					 //选择状态事件		   
				    $("#tapstate .mui-control-item").bind("tap",function()
					{					
							if(!$(this).hasClass("mui-active"))
							{
								$("#tapstate .mui-active").removeClass("mui-active");
								$(this).addClass("mui-active"); //由于默认的类添加比我的慢，所以我"多此一举"
								初始化数据();
								mui('#pullrefresh').pullRefresh().pullupLoading(); 
							}					
					})
					
					
					
					//选择时间之后
					document.getElementById("select_time").addEventListener('tap',function()
					{				
				        var optionsJson = JSON.parse(document.getElementById("dipicker").getAttribute('data-options')) || '{}';					
						var picker = new mui.DtPicker(optionsJson);
						picker.show(function(rs) 
						{		
							mui.toast('选择结果: ' + rs.text);
							
							初始化数据();
																			
							optionsJson.value = rs.text;
							$("#dipicker").attr("data-options",JSON.stringify(optionsJson));	
							
							
							mui('#pullrefresh').pullRefresh().pullupLoading();  //使用这个之后，自动会加载[下拉刷新]绑定的函数
						}) 
					})					  
		     }) 
		  
		  	//∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏ 载入事件 结束  ∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏
		  		     
		    
		    
		    //∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏ 上拉刷新、下拉加载 开始  ∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏
		    
		    //下拉刷新具体业务实现
			function pulldownRefresh() 
			{
				setTimeout(function() 
				{								
					mui.toast("刷新成功");  //暂未实现下拉刷新，甚至可能关闭此功能
					
					mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
				
				}, 1500);
			}        
		     		 	 
		    //上拉加载具体业务实现
			function pullupRefresh() 
			{
				//加载数据
				setTimeout(function() 
				{		
					var num =  $("#pullrefresh .mui-table-view-cell").size(); //列表总数
																		
					if(num >= cnt)
					{		
						mui('#pullrefresh').pullRefresh().endPullupToRefresh(num >= cnt); //参数为true代表没有更多数据了。
						return false;
					}
					
				
					var end,start;
				
					/* 获取dipicker的时间参数  */	
					var optionsJson = JSON.parse(document.getElementById("dipicker").getAttribute('data-options'));
					if(optionsJson.value != null)
					{ 
						end = optionsJson.value + " 23:59:59"; //用户选择的时间
						var pass = new Date(end);
					    start = new Date(pass.setMonth(pass.getMonth() - 2)).format("yyyy-MM-dd");		
					}
					else
					{
						 var now = new Date();
						 end = now.format("yyyy-MM-dd 23:59:59"); //今天 	
	     				 start = new Date(now.setMonth(now.getMonth() - 2)).format("yyyy-MM-dd");//两个月前
					}
					
					/* 获取和设置基本参数 */
					var page = parseInt($("#page").val()) + 1; //获取当前分页标识+1
					$("#page").val(page); //设置分页标识	
					state = Get_State(); //获取和设置当前状态
					 
				    InvokeApi(GetApiUrl("B003_V0001_5un29"), "ApiClass", "QueyCunPackage", {"userCode":CustomerCode,"status":state,"mobile":"","mailNo":"","beginTime":start,"endTime":end,"pageIndex":page,"pageSize":rows} , "CYAPI_代存列表");
					 
				}, 500);
			}       
			
			//∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏ 上拉刷新、下拉加载  结束  ∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏
			
			
			 
			 
			 //∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏ 方法体 开始 ∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏
			 
			 初始化数据 = function()
		     {		   
		     	$("#mui-table-view").html(""); //清空所有的数据	
		     	cnt = 1;//设置数据库总行数默认为1
				$("#page").val(0); //分页标识变为0			
		     	ResultJson = null; //清空返回数据		
		     	state = Get_State(); //获取和设置当前状态	
		    
		     	
		     	
		     	
		     	/* 初始化dipicker时间控制器的默认参数 */
		     	var opt = {};	//参数是一个json对象	
		     	var now= new Date(); 					//时间对象
		     	opt.value = now.format("yyyy-MM-dd"); 
		     	opt.type = "date";
		     	opt.beginYear =  now.getFullYear() - 1;		     	
		     	opt.endYear =  now.getFullYear();		     
		     	var str_json = JSON.stringify(opt);	  
		     	$("#dipicker").attr("data-options",str_json);	     	
		     	
		     
		     	
		     	
		     	mui('#pullrefresh').pullRefresh().refresh(true);	 //恢复滚动
		     	mui('#pullrefresh').pullRefresh().scrollTo(0,0,100); //滚动置顶
		     }  
			
			 
			  
			//订单列表
			CYAPI_代存列表 = function(str)
			{						
				var jsonobj = Api_filter(str);

				ResultJson = jsonobj["packageList"] || {};	
				
				cnt = jsonobj.rowCount; //数据库总数,存放在公共变量中去
				
				if(cnt.toString() == "0")
				{						
					mui('#pullrefresh').pullRefresh().endPullupToRefresh(true);						
					return false;
				}				
										
				//替换美化文本
				$.each(ResultJson,function(i,o)
				{				
					
					o.status = replace_ico(o.status); //将状态更改为图标
					o.cunDateTime = timeFormat(o.cunDateTime);	//将收包裹时间美化
					o.quDateTime = timeFormat(o.quDateTime);	//将取包裹时间美化
				
				
					if(o.quDateTime == "")
					{
						//如果取包裹时间不为空，说明包裹已被取走，那么就使用取包裹的时间
						o.cunDateTime = o.quDateTime; 
					}
				})
				
								
				var temple_html = $("#temple").html();	
				
				
				laytpl(temple_html).render(ResultJson, function (html)
		        {        		 	      
		            $("#mui-table-view").append(html);      //填充初始化数据	                  
		        });    	
		        		    
				var num =  $("#pullrefresh .mui-table-view-cell").size();	//列表总数
								
				mui('#pullrefresh').pullRefresh().endPullupToRefresh(num >= cnt); //参数为true代表没有更多数据了。
			}
			
			
			 //替换状态为图标 	1，已收(已登记) 2，已取，3，已退
			 replace_ico = function(str)
			 {			 	
			 	if(str == "1")
			 	{
			 		str = "&nbsp;&#xe604;";			 		
			 	}
			 	else if(str == "2")
			 	{
			 		str = "&nbsp;&#xe603;";
			 	}
			 	else if(str == "3")
			 	{
			 		str = "&nbsp;&#xe613;";
			 	}
			 	
			 	return str;
			 }
			 
			 
			 //获取当前模式
			Get_State = function()
			{
				var text = $("#tapstate .mui-active").text();				
				
				if(text == "所有物品")
				{
					return "-1"; 
				}
				else if(text == "未收物品")
				{
					return "1";
				}
				else if(text == "已收物品")
				{
					return "2";
				}
				else if(text == "已退物品")
				{
					return "3";					
				}
			}
			
			
			 //∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏ 方法体 结束 ∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏
			 
			 
			 
			 
			 
			
			 
			  
			//∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏ 以下区域不必改动 ∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏∏
			 
			 
			//初始化单页view
			var viewApi = mui('#app').view
			({
				defaultPage: '#Main'
			});
				
				
		
			mui.init
			({
				pullRefresh: 
				{
					container: '#pullrefresh',
					down: 
					{
						callback: pulldownRefresh
					},
					up: 
					{
						contentrefresh: '正在加载...',
						contentnomore:'没有更多数据了',
						contentdown:"", //默认值'下拉加载更多'，这里设为空
						callback: pullupRefresh
					}
				}
			}); 
			  
			if (mui.os.plus) 
			{
					mui.plusReady(function() {
						setTimeout(function() {
							mui('#pullrefresh').pullRefresh().pullupLoading();
						}, 1000);
		
					}); 
			} 
			else
			{
					mui.ready(function() {
						mui('#pullrefresh').pullRefresh().pullupLoading();
					});
			}
			
			var view = viewApi.view;
			(function($) {
				//处理view的后退与webview后退
				var oldBack = $.back;
				$.back = function() {
					if (viewApi.canBack()) { //如果view可以后退，则执行view的后退
						viewApi.back();
					} else { //执行webview后退
						oldBack();
					}
				};
				//监听页面切换事件方案1,通过view元素监听所有页面切换事件，目前提供pageBeforeShow|pageShow|pageBeforeBack|pageBack四种事件(before事件为动画开始前触发)
				//第一个参数为事件名称，第二个参数为事件回调，其中e.detail.page为当前页面的html对象
				view.addEventListener('pageBeforeShow', function(e) {
					//				console.log(e.detail.page.id + ' beforeShow');
				});
				view.addEventListener('pageShow', function(e) {
					//				console.log(e.detail.page.id + ' show');
				});
				view.addEventListener('pageBeforeBack', function(e) {
					//				console.log(e.detail.page.id + ' beforeBack');
				});
				view.addEventListener('pageBack', function(e) {
					//				console.log(e.detail.page.id + ' back');
				});
			})(mui);
			
			
			
			
		</script>
	</body>
